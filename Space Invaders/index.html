<!doctype html>
<html lang="on">
	<head>
		<meta charset = "UTF-8">
		<title>Space Invaders</title>

		<script src="javascript/helpers.js"></script>

		<style>
		canvas {
			background-color: #000;
			display: block;
			position: absolute;
			margin: auto;
			top: 0;
			bottom: 0;
			left: 0;
			right: 0;
		}
		</style>
	</head>
	<body>

		<header>
			<h1>Space Invaders</h1>
			<h2>By Jonathan Li and Emily Wong</h2>
			<h2>Let the Space Drop</h2>
		</header>
		<script>

			var screen;
			var input;
			var frames;
			var alSprite;
			var taSprite;
			var aliens;
			var dir;
			var tank;
			var bullets;
			var cities;
			var alSpeed;

			function main() {
				screen = new Screen(510, 600);
				input = new InputHandeler();

				var imgInvad = new Image();
				imgInvad.addEventListener("load", function() {
					alSprite = new Sprite(this, 0, 0, 30, 30);

					init();
					run();

				});
				imgInvad.src = "res/space_invader.jpg"

				var imgTank = new Image();
				imgTank.addEventListener("load", function() {
					taSprite = new Sprite(this, 0, 0, 66, 30);

					init();
					run();

				});
				imgTank.src = "res/tankpic.jpg"
			};

			function init() {
				frames = 0;
				spFrame = 0;
				lvFrame = 20;
				dir = 1;

				tank = {
					sprite: taSprite,
					x: (screen.width - taSprite.w) / 2,
					y: screen.height - (30 + taSprite.h)
				}; 

				bullets = [];

				alien = {
					sprite: alSprite,
					x: Math.floor((Math.random() * 440) + 30),
					y: alSprite.y
				}

				aliens = 0;
				var rows = [1, 0, 0, 2, 2];
				for (var i = 0; i < rows.length; i++) {
					/*for (var j = 0; j < 10; j++) {
						var a = rows[i];
						aliens.push({
							sprite: alSprite, 
							x: 30 + j*30,
							y: 30 + i*30,
							w: alSprite.w,
							h: alSprite.h
							//ended here at 17:52  25:30
						});
					}*/
				}
			};

			function run() {
				var loop = function() {
					update();
					render();

					window.requestAnimationFrame(loop, screen.canvas);

				};
				window.requestAnimationFrame(loop, screen.canvas);

			};

			function update() {
				if(input.isDown(37)){
					tank.x -= 4;
				}

				if (input.isDown(39)){
					tank.x += 4;
				}

				tank.x = Math.max(Math.min(tank.x, screen.width - (taSprite.w)), 0);

				if(input.isPressed(32)) {
					bullets.push(new Bullet(tank.x + 10, tank.y, -8, 2, 6, white));
				}
				for(var i = 0, len = bullets.length; i < len; i++) {
					var b = bullets[i];
					b.update();

					/*if (b.y + b.height < 0 || b.y > screen.height) {
						bullets.splice(i, 1);
						i--;
						len--;
						continue;

						// 8:24
					}*/
				}
			};

			function render() {
				screen.drawSprite(alien.sprite, alien.x, alien.y);
				alFall();
<<<<<<< HEAD
				/*for (var i = 0; i < aliens.length; i++) {
					var a = aliens[i];
					screen.drawSprite(a.sprite, a.x, a.y);
				}*/
				screen.drawSprite(tank.sprite, tank.x, tank.y);
=======
				

>>>>>>> origin/master
				screen.ctx.save();
				for(var i = 0, len = bullets.length; i < len; i++) {
					screen.drawBullet(bullets[i]);
				}
				screen.ctx.restore;

			};

			function alFall() {
				alSpeed = Math.floor((Math.random() * 3) + 1);
				alien.y += alSpeed;
				if(alien.y > screen.height) {
					alien.y = 0;
					alien.x = Math.floor((Math.random() * 440) + 30);
					alSpeed = Math.floor((Math.random() * 8) + 1);
				}

			};

			main();
		</script>
	</body>
</html>